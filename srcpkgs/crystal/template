# Template file for 'crystal'
#
# i am very tired
# do not use this.

pkgname=crystal
version=1.0.0
revision=1
archs="x86_64"
hostmakedepends="which tar git llvm10 pkg-config"
makedepends="gc-devel libatomic_ops pcre-devel libevent-devel libyaml-devel
 libxml2-devel"
depends="gc-devel libatomic_ops pcre-devel libevent-devel libyaml-devel
 libxml2-devel gmp-devel openssl-devel llvm10 gcc pkg-config"
checkdepends="readline-devel libyaml-devel gmp-devel openssl-devel"
short_desc="Crystal Programming Language"
maintainer="luna <personal_void@l4.pm>"
license="Apache-2.0"
homepage="https://crystal-lang.org/"
distfiles="https://github.com/crystal-lang/crystal/releases/download/1.0.0/crystal-${version}-1-linux-x86_64.tar.gz>crystal-bin.tar.gz"
checksum="00211ca77758e99210ec40b8c5517b086d2ff9909e089400f6d847a95e5689a4"

do_extract() {
	mkdir -p ${wrksrc}/{shards,shards/lib,shards/lib/molinillo,molinillo,$(vopt_if binary_bootstrap bootstrap)}

	tar xfz ${XBPS_SRCDISTDIR}/${pkgname}-${version}/crystal-bin.tar.gz --strip-components=1 -C ${wrksrc}
}

do_build() {
    echo 'none'
}

do_install() {
	vmkdir /usr/bin
	vmkdir /usr/lib/crystal
	vmkdir /usr/share/crystal
	vmkdir /usr/share/doc/crystal
	vmkdir /usr/share/doc/crystal/api
	vmkdir /usr/share/licenses/shards

	vbin bin/crystal
	vbin bin/shards

	vcopy share/crystal/* /usr/share/crystal
	vcopy lib/crystal/* /usr/lib/crystal

	vcopy share/doc/crystal /usr/share/doc/crystal
	#vcopy /usr/lib/crystal
	#vcopy docs/* /usr/share/doc/crystal/api
	#vcopy src/* /usr/lib/crystal
	#vbin .build/crystal crystal
	vman share/man/man1/crystal.1.gz
	vman share/man/man1/shards.1.gz
	vman share/man/man5/shard.yml.5.gz
	# vbin shards/bin/shards
	# cp shards/LICENSE ${DESTDIR}/usr/share/licenses/shards
}

