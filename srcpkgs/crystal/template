# Template file for 'crystal'
#
# i am very tired
# do not use this.

pkgname=crystal
version=1.5.0
revision=2
archs="x86_64"
hostmakedepends="which tar git llvm11 pkg-config"
makedepends="gc-devel libatomic_ops pcre-devel libevent-devel libyaml-devel
 libxml2-devel"
depends="gc-devel libatomic_ops pcre-devel libevent-devel libyaml-devel
 libxml2-devel gmp-devel openssl-devel llvm12 gcc pkg-config"
checkdepends="readline-devel libyaml-devel gmp-devel openssl-devel"
short_desc="Crystal Programming Language"
maintainer="luna <personal_void@l4.pm>"
license="Apache-2.0"
homepage="https://crystal-lang.org/"
distfiles="https://github.com/crystal-lang/crystal/releases/download/${version}/crystal-${version}-1-linux-x86_64.tar.gz>crystal-bin.tar.gz"
checksum="627360f0fc805202d80310007d503c7a2fc0745b1db2211537d7f54e9a994347"
build_style=fetch

do_extract() {
	mkdir -p ${wrksrc}/{shards,shards/lib,shards/lib/molinillo,molinillo,$(vopt_if binary_bootstrap bootstrap)}

	tar xfz ${XBPS_SRCDISTDIR}/${pkgname}-${version}/crystal-bin.tar.gz --strip-components=1 -C ${wrksrc}
}

do_install() {
	vmkdir /usr/bin
	vmkdir /usr/lib/crystal
	vmkdir /usr/share/crystal
	vmkdir /usr/share/doc/crystal
	vmkdir /usr/share/doc/crystal/api
	vmkdir /usr/share/licenses/shards

	vbin bin/crystal
	vbin bin/shards

	vcopy share/crystal/* /usr/share/crystal
	vcopy lib/crystal/* /usr/lib/crystal

	#vcopy share/doc/crystal /usr/share/doc/crystal
	#vcopy /usr/lib/crystal
	#vcopy docs/* /usr/share/doc/crystal/api
	#vcopy src/* /usr/lib/crystal
	#vbin .build/crystal crystal
	vman share/man/man1/crystal.1.gz
	vman share/man/man1/shards.1.gz
	vman share/man/man5/shard.yml.5.gz
	# vbin shards/bin/shards
	# cp shards/LICENSE ${DESTDIR}/usr/share/licenses/shards
}

